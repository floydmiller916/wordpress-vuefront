{"version":3,"sources":["../../../../src/store/store/cart/cart.ts"],"names":["gql","find","state","cart","products","getters","get","mutations","setCart","actions","add","commit","dispatch","rootGetters","product","quantity","options","redirect","mutation","variables","id","root","addToCart","$router","push","update","key","updateCart","removeByProductId","productId","o","remove","removeCart","load","data","$vfapollo","query","e"],"mappings":"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","sourcesContent":["import { MutationTree, GetterTree, ActionTree } from \"vuex\";\r\nimport { RootState } from \"vuefront-store\";\r\nimport { Cart } from \"vuefront-api\";\r\nimport gql from \"graphql-tag\";\r\nimport { find } from \"lodash\";\r\n\r\nexport type State = {\r\n  cart: Cart;\r\n};\r\n\r\nexport const state: State = {\r\n  cart: {\r\n    products: [],\r\n  },\r\n};\r\n\r\nexport const getters: GetterTree<State, RootState> = {\r\n  get(state) {\r\n    return state.cart;\r\n  },\r\n};\r\n\r\nexport const mutations: MutationTree<State> = {\r\n  setCart(state, cart) {\r\n    state.cart = cart;\r\n  },\r\n};\r\n\r\nexport const actions: ActionTree<State, RootState> = {\r\n  async add(\r\n    { commit, dispatch, rootGetters },\r\n    { product, quantity = 1, options = [], redirect = false }\r\n  ) {\r\n    await dispatch(\r\n      \"apollo/mutate\",\r\n      {\r\n        mutation: gql`\r\n          mutation ($id: String, $quantity: Int, $options: [CartOption]) {\r\n            addToCart(id: $id, quantity: $quantity, options: $options) {\r\n              products {\r\n                key\r\n                quantity\r\n                total\r\n                option {\r\n                  name\r\n                  value\r\n                  type\r\n                }\r\n                product {\r\n                  id\r\n                  name\r\n                  model\r\n                  price\r\n                  image\r\n                  imageLazy\r\n                  extra {\r\n                    name\r\n                    value\r\n                  }\r\n                  manufacturer {\r\n                    id\r\n                    name\r\n                    url(url: \"/store/manufacturer/_id\")\r\n                  }\r\n                }\r\n              }\r\n              total\r\n            }\r\n          }\r\n        `,\r\n        variables: {\r\n          id: product.id,\r\n          quantity,\r\n          options,\r\n        },\r\n      },\r\n      {\r\n        root: true,\r\n      }\r\n    );\r\n\r\n    if (!rootGetters[\"vuefront/error\"]) {\r\n      commit(\"setCart\", rootGetters[\"apollo/get\"].addToCart);\r\n      if (!rootGetters[\"vuefront/sidebarCart\"]) {\r\n        commit(\"vuefront/toggleSidebarCart\", {}, { root: true });\r\n      }\r\n    } else {\r\n      commit(\"notification/error\", rootGetters[\"vuefront/error\"], {\r\n        root: true,\r\n      });\r\n\r\n      if (redirect) {\r\n        this.$router.push(\"/store/product/\" + product.id);\r\n      }\r\n    }\r\n  },\r\n  async update({ commit, dispatch, rootGetters }, { key, quantity }) {\r\n    await dispatch(\r\n      \"apollo/mutate\",\r\n      {\r\n        mutation: gql`\r\n          mutation ($key: String, $quantity: Int) {\r\n            updateCart(key: $key, quantity: $quantity) {\r\n              products {\r\n                key\r\n                quantity\r\n                total\r\n                option {\r\n                  name\r\n                  value\r\n                  type\r\n                }\r\n                product {\r\n                  id\r\n                  name\r\n                  model\r\n                  price\r\n                  image\r\n                  imageLazy\r\n                  extra {\r\n                    name\r\n                    value\r\n                  }\r\n                  manufacturer {\r\n                    id\r\n                    name\r\n                    url(url: \"/store/manufacturer/_id\")\r\n                  }\r\n                }\r\n              }\r\n              total\r\n            }\r\n          }\r\n        `,\r\n        variables: {\r\n          key,\r\n          quantity,\r\n        },\r\n      },\r\n      {\r\n        root: true,\r\n      }\r\n    );\r\n    if (!rootGetters[\"vuefront/error\"]) {\r\n      commit(\"setCart\", rootGetters[\"apollo/get\"].updateCart);\r\n    }\r\n  },\r\n  async removeByProductId({ dispatch, getters }, { productId }) {\r\n    const product = find(\r\n      getters.get.products,\r\n      (o) => o.product.id === productId\r\n    );\r\n    if (product) {\r\n      await dispatch(\"remove\", { key: product.key });\r\n    }\r\n  },\r\n  async remove({ commit, dispatch, rootGetters }, { key }) {\r\n    await dispatch(\r\n      \"apollo/mutate\",\r\n      {\r\n        mutation: gql`\r\n          mutation ($key: String) {\r\n            removeCart(key: $key) {\r\n              products {\r\n                key\r\n                quantity\r\n                total\r\n                option {\r\n                  name\r\n                  value\r\n                  type\r\n                }\r\n                product {\r\n                  id\r\n                  name\r\n                  model\r\n                  price\r\n                  image\r\n                  imageLazy\r\n                  extra {\r\n                    name\r\n                    value\r\n                  }\r\n                  manufacturer {\r\n                    id\r\n                    name\r\n                    url(url: \"/store/manufacturer/_id\")\r\n                  }\r\n                }\r\n              }\r\n              total\r\n            }\r\n          }\r\n        `,\r\n        variables: {\r\n          key,\r\n        },\r\n      },\r\n      {\r\n        root: true,\r\n      }\r\n    );\r\n\r\n    if (!rootGetters[\"vuefront/error\"]) {\r\n      commit(\"setCart\", rootGetters[\"apollo/get\"].removeCart);\r\n    }\r\n  },\r\n  async load({ commit, dispatch, rootGetters }) {\r\n    try {\r\n      const { data } = await this.$vfapollo.query({\r\n        query: gql`\r\n          {\r\n            cart {\r\n              products {\r\n                key\r\n                quantity\r\n                total\r\n                option {\r\n                  name\r\n                  value\r\n                  type\r\n                }\r\n                product {\r\n                  id\r\n                  name\r\n                  model\r\n                  price\r\n                  image\r\n                  imageLazy\r\n                  extra {\r\n                    name\r\n                    value\r\n                  }\r\n                  manufacturer {\r\n                    id\r\n                    name\r\n                    url(url: \"/store/manufacturer/_id\")\r\n                  }\r\n                }\r\n              }\r\n              total\r\n            }\r\n          }\r\n        `,\r\n      });\r\n\r\n      commit(\"setCart\", data.cart);\r\n    } catch (e) {\r\n      commit(\"vuefront/setResponseError\", e, {\r\n        root: true,\r\n      });\r\n    }\r\n  },\r\n};\r\n"],"file":"cart.mjs"}