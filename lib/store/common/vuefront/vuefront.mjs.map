{"version":3,"sources":["../../../../src/store/common/vuefront/vuefront.ts"],"names":["gql","state","error","ssr","sidebar","sidebarCart","version","mutations","toggleSidebar","toggleSidebarCart","setResponseError","e","graphQLErrors","message","setError","payload","setSSR","setVersion","getters","actions","checkVersion","commit","data","$vfapollo","query","vuefrontInit","dispatch","$vuefront","api","console","log","$router","push","beforeEach","to","from","next","path","$cookies","get","root","Promise","all","nuxtServerInit","nuxtClientInit","rootGetters"],"mappings":"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","sourcesContent":["import { MutationTree, GetterTree, ActionTree } from \"vuex\";\r\nimport { RootState } from \"vuefront-store\";\r\nimport gql from \"graphql-tag\";\r\nexport type State = {\r\n  error: boolean | string;\r\n  ssr: boolean;\r\n  sidebar: boolean;\r\n  sidebarCart: boolean;\r\n  version: string;\r\n};\r\nexport const state: State = {\r\n  error: false,\r\n  ssr: false,\r\n  sidebar: false,\r\n  sidebarCart: false,\r\n  version: \"1.0.0\",\r\n};\r\n\r\nexport const mutations: MutationTree<State> = {\r\n  toggleSidebar(state) {\r\n    state.sidebar = !state.sidebar;\r\n  },\r\n  toggleSidebarCart(state) {\r\n    state.sidebarCart = !state.sidebarCart;\r\n  },\r\n  setResponseError(state, e) {\r\n    if (e.graphQLErrors && e.graphQLErrors.message) {\r\n      state.error = e.graphQLErrors.message;\r\n    } else if (e.graphQLErrors && typeof e.graphQLErrors[0] !== \"undefined\") {\r\n      state.error = e.graphQLErrors[0].message;\r\n    } else if (e.graphQLErrors) {\r\n      state.error = e.graphQLErrors;\r\n    } else {\r\n      state.error = e;\r\n    }\r\n  },\r\n  setError(state, payload) {\r\n    state.error = payload;\r\n  },\r\n  setSSR(state, payload) {\r\n    state.ssr = payload;\r\n  },\r\n  setVersion(state, payload) {\r\n    state.version = payload;\r\n  },\r\n};\r\n\r\nexport const getters: GetterTree<State, RootState> = {\r\n  sidebar(state) {\r\n    return state.sidebar;\r\n  },\r\n  sidebarCart(state) {\r\n    return state.sidebarCart;\r\n  },\r\n  error(state) {\r\n    return state.error;\r\n  },\r\n  ssr(state) {\r\n    return state.ssr;\r\n  },\r\n  version(state) {\r\n    return state.version;\r\n  },\r\n};\r\n\r\nexport const actions: ActionTree<State, RootState> = {\r\n  async checkVersion({ commit }) {\r\n    try {\r\n      const { data } = await this.$vfapollo.query({\r\n        query: gql`\r\n          {\r\n            version\r\n          }\r\n        `,\r\n      });\r\n      commit(\"setVersion\", data.version);\r\n    } catch (e) {\r\n      commit(\"setVersion\", \"0.0.1\");\r\n    }\r\n  },\r\n  async vuefrontInit({ dispatch, commit, getters }) {\r\n    await dispatch(\"checkVersion\");\r\n    if (this.$vuefront.version.api > getters[\"version\"]) {\r\n      console.log(\"deprecated api\");\r\n      this.$router.push(\"/deprecated-api\");\r\n      this.$router.beforeEach((to, from, next) => {\r\n        if (to.path !== \"/deprecated-api\") {\r\n          next(\"/deprecated-api\");\r\n          return;\r\n        }\r\n        next();\r\n      });\r\n      return;\r\n    }\r\n    if (this.$cookies.get(\"token\")) {\r\n      commit(\"common/customer/setToken\", this.$cookies.get(\"token\"), {\r\n        root: true,\r\n      });\r\n    }\r\n    await Promise.all([\r\n      dispatch(\"store/cart/load\", {}, { root: true }),\r\n      dispatch(\"common/language/load\", {}, { root: true }),\r\n      dispatch(\"common/customer/checkLogged\", {}, { root: true }),\r\n      dispatch(\"store/currency/load\", {}, { root: true }),\r\n    ]);\r\n\r\n    if (this.$cookies.get(\"mode\")) {\r\n      commit(\"store/category/setMode\", this.$cookies.get(\"mode\"), {\r\n        root: true,\r\n      });\r\n    }\r\n  },\r\n  async nuxtServerInit({ dispatch, commit }) {\r\n    await dispatch(\"vuefrontInit\");\r\n    commit(\"setSSR\", true);\r\n  },\r\n  async nuxtClientInit({ commit, dispatch, rootGetters }) {\r\n    this.$router.beforeEach((to, from, next) => {\r\n      if (to.path !== from.path && rootGetters[\"vuefront/sidebar\"]) {\r\n        commit(\"toggleSidebar\");\r\n      }\r\n      next();\r\n    });\r\n    if (!rootGetters[\"vuefront/ssr\"]) {\r\n      await dispatch(\"vuefrontInit\");\r\n    }\r\n  },\r\n};\r\n"],"file":"vuefront.mjs"}