{"version":3,"sources":["../../../../src/store/common/vuefront/vuefront.ts"],"names":["state","error","ssr","sidebar","mutations","toggleSidebar","setResponseError","e","graphQLErrors","message","setError","payload","setSSR","getters","actions","vuefrontInit","dispatch","commit","$cookies","get","root","Promise","all","nuxtServerInit","console","log","nuxtClientInit","rootGetters","$router","beforeEach","to","from","next","path"],"mappings":"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","sourcesContent":["import { MutationTree, GetterTree, ActionTree } from \"vuex\";\nimport { RootState } from \"vuefront-store\";\nexport type State = {\n  error: boolean | string;\n  ssr: boolean;\n  sidebar: boolean;\n};\nexport const state: State = {\n  error: false,\n  ssr: false,\n  sidebar: false,\n};\n\nexport const mutations: MutationTree<State> = {\n  toggleSidebar(state) {\n    state.sidebar = !state.sidebar;\n  },\n  setResponseError(state, e) {\n    if (e.graphQLErrors && e.graphQLErrors.message) {\n      state.error = e.graphQLErrors.message;\n    } else if (e.graphQLErrors && typeof e.graphQLErrors[0] !== \"undefined\") {\n      state.error = e.graphQLErrors[0].message;\n    } else if (e.graphQLErrors) {\n      state.error = e.graphQLErrors;\n    } else {\n      state.error = e;\n    }\n  },\n  setError(state, payload) {\n    state.error = payload;\n  },\n  setSSR(state, payload) {\n    state.ssr = payload;\n  },\n};\n\nexport const getters: GetterTree<State, RootState> = {\n  sidebar(state) {\n    return state.sidebar;\n  },\n  error(state) {\n    return state.error;\n  },\n  ssr(state) {\n    return state.ssr;\n  },\n};\n\nexport const actions: ActionTree<State, RootState> = {\n  async vuefrontInit({ dispatch, commit }) {\n    if (this.$cookies.get(\"token\")) {\n      commit(\"common/customer/setToken\", this.$cookies.get(\"token\"), {\n        root: true,\n      });\n    }\n    await Promise.all([\n      dispatch(\"common/language/load\", {}, { root: true }),\n      dispatch(\"common/customer/checkLogged\", {}, { root: true }),\n      dispatch(\"store/currency/load\", {}, { root: true }),\n    ]);\n\n    if (this.$cookies.get(\"mode\")) {\n      commit(\"store/category/setMode\", this.$cookies.get(\"mode\"), {\n        root: true,\n      });\n    }\n  },\n  async nuxtServerInit({ dispatch, commit }) {\n    console.log(\"nuxtServerInit\");\n    await dispatch(\"vuefrontInit\");\n    commit(\"setSSR\", true);\n  },\n  async nuxtClientInit({ commit, dispatch, rootGetters }) {\n    this.$router.beforeEach((to, from, next) => {\n      if (to.path !== from.path && rootGetters[\"vuefront/sidebar\"]) {\n        commit(\"toggleSidebar\");\n      }\n      next();\n    });\n    if (!rootGetters[\"vuefront/ssr\"]) {\n      await dispatch(\"vuefrontInit\");\n    }\n  },\n};\n"],"file":"vuefront.mjs"}