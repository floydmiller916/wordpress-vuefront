{"version":3,"sources":["../../../../src/store/common/apollo/apollo.ts"],"names":["omitDeepLodash","axios","adapterAxios","state","data","prefetchData","getters","get","mutations","setData","payload","setPrefetchData","key","actions","query","commit","options","variables","res","$vfapollo","root","e","mutate","errors","clearStore","upload","o","mutation","loc","source","body","map","i","fd","FormData","append","JSON","stringify","File","toString","create","withCredentials","post","$vuefront","baseURL"],"mappings":"AAAA,OAAOA,cAAP,MAA2B,kBAA3B,C,CACA;;AACA,SAASC,KAAK,IAAIC,YAAlB,QAAsC,2BAAtC;AAQA,OAAO,MAAMC,KAAY,GAAG;AAC1BC,EAAAA,IAAI,EAAE,EADoB;AAE1BC,EAAAA,YAAY,EAAE;AAFY,CAArB;AAKP,OAAO,MAAMC,OAAqC,GAAG;AACnDC,EAAAA,GAAG,CAACJ,KAAD,EAAQ;AACT,WAAOA,KAAK,CAACC,IAAb;AACD,GAHkD;;AAInDC,EAAAA,YAAY,CAACF,KAAD,EAAQ;AAClB,WAAOA,KAAK,CAACE,YAAb;AACD;;AANkD,CAA9C;AASP,OAAO,MAAMG,SAA8B,GAAG;AAC5CC,EAAAA,OAAO,CAACN,KAAD,EAAQO,OAAR,EAAiB;AACtBP,IAAAA,KAAK,CAACC,IAAN,GAAa,EAAE,GAAGD,KAAK,CAACC,IAAX;AAAiB,SAAGM,OAAO,CAACN;AAA5B,KAAb;AACD,GAH2C;;AAI5CO,EAAAA,eAAe,CAACR,KAAD,EAAQ;AAAES,IAAAA,GAAF;AAAOR,IAAAA;AAAP,GAAR,EAAuB;AACpCD,IAAAA,KAAK,CAACE,YAAN,CAAmBO,GAAnB,IAA0BR,IAA1B;AACD;;AAN2C,CAAvC;AASP,OAAO,MAAMS,OAAqC,GAAG;AACnD,QAAMC,KAAN,CAAY;AAAEC,IAAAA;AAAF,GAAZ,EAAwBC,OAAxB,EAAiC;AAC/B,QAAI;AACF,YAAMC,SAAS,GAAGjB,cAAc,CAACgB,OAAO,CAACC,SAAT,EAAoB,YAApB,CAAhC;AACA,UAAIC,GAAG,GAAG,MAAM,KAAKC,SAAL,CAAeL,KAAf,CAAqB,EAAE,GAAGE,OAAL;AAAcC,QAAAA;AAAd,OAArB,CAAhB;AAEAC,MAAAA,GAAG,GAAGlB,cAAc,CAACkB,GAAD,EAAM,YAAN,CAApB;AACAH,MAAAA,MAAM,CAAC,mBAAD,EAAsB,KAAtB,EAA6B;AAAEK,QAAAA,IAAI,EAAE;AAAR,OAA7B,CAAN;AACAL,MAAAA,MAAM,CAAC,SAAD,EAAYG,GAAZ,CAAN;AACD,KAPD,CAOE,OAAOG,CAAP,EAAU;AACVN,MAAAA,MAAM,CAAC,2BAAD,EAA8BM,CAA9B,EAAiC;AACrCD,QAAAA,IAAI,EAAE;AAD+B,OAAjC,CAAN;AAGD;AACF,GAdkD;;AAenD,QAAME,MAAN,CAAa;AAAEP,IAAAA;AAAF,GAAb,EAAyBC,OAAzB,EAAkC;AAChC,QAAI;AACF,YAAMC,SAAS,GAAGjB,cAAc,CAACgB,OAAO,CAACC,SAAT,EAAoB,YAApB,CAAhC;AACA,YAAMC,GAAG,GAAG,MAAO,KAAKC,SAAN,CAAwBG,MAAxB,CAA+B,EAC/C,GAAGN,OAD4C;AAE/CC,QAAAA;AAF+C,OAA/B,CAAlB;;AAIA,UAAI,CAACC,GAAG,CAACK,MAAT,EAAiB;AACfR,QAAAA,MAAM,CAAC,mBAAD,EAAsB,KAAtB,EAA6B;AAAEK,UAAAA,IAAI,EAAE;AAAR,SAA7B,CAAN;AACAL,QAAAA,MAAM,CAAC,SAAD,EAAYG,GAAZ,CAAN;AACD,OAHD,MAGO;AACLH,QAAAA,MAAM,CAAC,mBAAD,EAAsBG,GAAG,CAACK,MAA1B,EAAkC;AACtCH,UAAAA,IAAI,EAAE;AADgC,SAAlC,CAAN;AAGD;;AACD,WAAKD,SAAL,CAAeK,UAAf;AACD,KAfD,CAeE,OAAOH,CAAP,EAAU;AACVN,MAAAA,MAAM,CAAC,2BAAD,EAA8BM,CAA9B,EAAiC;AACrCD,QAAAA,IAAI,EAAE;AAD+B,OAAjC,CAAN;AAGD;AACF,GApCkD;;AAqCnD,QAAMK,MAAN,CACE;AAAEV,IAAAA;AAAF,GADF,EAEEC,OAFF,EAGE;AACA,QAAI;AACF,YAAMC,SAAiC,GAAGjB,cAAc,CACtDgB,OAAO,CAACC,SAD8C,EAEtD,YAFsD,CAAxD;AAKA,YAAMS,CAAC,GAAG;AACRZ,QAAAA,KAAK,EAAEE,OAAO,CAACW,QAAR,CAAiBC,GAAjB,CAAqBC,MAArB,CAA4BC,IAD3B;AAERb,QAAAA;AAFQ,OAAV;AAKA,YAAMc,GAA8B,GAAG;AACrC,WAAG;AADkC,OAAvC;AAIA,UAAIC,CAAS,GAAG,CAAhB;AACA,YAAMC,EAAE,GAAG,IAAIC,QAAJ,EAAX;AACAD,MAAAA,EAAE,CAACE,MAAH,CAAU,YAAV,EAAwBC,IAAI,CAACC,SAAL,CAAeX,CAAf,CAAxB;;AACA,WAAK,MAAMd,GAAX,IAAkBK,SAAlB,EAA6B;AAC3B,YACE,OAAOA,SAAS,CAACL,GAAD,CAAhB,KAA0B,QAA1B,IACAK,SAAS,CAACL,GAAD,CAAT,YAA0B0B,IAF5B,EAGE;AACAP,UAAAA,GAAG,CAACC,CAAD,CAAH,GAASpB,GAAT;AACAqB,UAAAA,EAAE,CAACE,MAAH,CAAUH,CAAC,CAACO,QAAF,EAAV,EAAwBtB,SAAS,CAACL,GAAD,CAAjC;AACAoB,UAAAA,CAAC;AACF;AACF;;AAEDC,MAAAA,EAAE,CAACE,MAAH,CAAU,KAAV,EAAiBC,IAAI,CAACC,SAAL,CAAeN,GAAf,CAAjB;AACA,YAAM9B,KAAK,GAAGC,YAAY,CAACsC,MAAb,CAAoB;AAChCC,QAAAA,eAAe,EAAE;AADe,OAApB,CAAd;AAGA,YAAM;AAAErC,QAAAA;AAAF,UAAW,MAAMH,KAAK,CAACyC,IAAN,CAAW,KAAKC,SAAL,CAAeC,OAA1B,EAAmCX,EAAnC,CAAvB;;AAEA,UAAI,CAAC7B,IAAI,CAACmB,MAAV,EAAkB;AAChBR,QAAAA,MAAM,CAAC,mBAAD,EAAsB,KAAtB,EAA6B;AAAEK,UAAAA,IAAI,EAAE;AAAR,SAA7B,CAAN;AACAL,QAAAA,MAAM,CAAC,SAAD,EAAYX,IAAZ,CAAN;AACD,OAHD,MAGO;AACLW,QAAAA,MAAM,CAAC,mBAAD,EAAsBX,IAAI,CAACmB,MAA3B,EAAmC;AACvCH,UAAAA,IAAI,EAAE;AADiC,SAAnC,CAAN;AAGD;AACF,KA3CD,CA2CE,OAAOC,CAAP,EAAU;AACVN,MAAAA,MAAM,CAAC,2BAAD,EAA8BM,CAA9B,EAAiC;AACrCD,QAAAA,IAAI,EAAE;AAD+B,OAAjC,CAAN;AAGD;AACF;;AAzFkD,CAA9C","sourcesContent":["import omitDeepLodash from \"omit-deep-lodash\";\r\n//@ts-ignore\r\nimport { axios as adapterAxios } from \"@bundled-es-modules/axios\";\r\nimport { MutationTree, GetterTree, ActionTree } from \"vuex\";\r\nimport {} from \"vuefront-api\";\r\nimport { RootState } from \"vuefront-store\";\r\nexport type State = {\r\n  data: any;\r\n  prefetchData: { [key: string]: any };\r\n};\r\nexport const state: State = {\r\n  data: {},\r\n  prefetchData: {},\r\n};\r\n\r\nexport const getters: GetterTree<State, RootState> = {\r\n  get(state) {\r\n    return state.data;\r\n  },\r\n  prefetchData(state) {\r\n    return state.prefetchData;\r\n  },\r\n};\r\n\r\nexport const mutations: MutationTree<State> = {\r\n  setData(state, payload) {\r\n    state.data = { ...state.data, ...payload.data };\r\n  },\r\n  setPrefetchData(state, { key, data }) {\r\n    state.prefetchData[key] = data;\r\n  },\r\n};\r\n\r\nexport const actions: ActionTree<State, RootState> = {\r\n  async query({ commit }, options) {\r\n    try {\r\n      const variables = omitDeepLodash(options.variables, \"__typename\");\r\n      let res = await this.$vfapollo.query({ ...options, variables });\r\n\r\n      res = omitDeepLodash(res, \"__typename\");\r\n      commit(\"vuefront/setError\", false, { root: true });\r\n      commit(\"setData\", res);\r\n    } catch (e) {\r\n      commit(\"vuefront/setResponseError\", e, {\r\n        root: true,\r\n      });\r\n    }\r\n  },\r\n  async mutate({ commit }, options) {\r\n    try {\r\n      const variables = omitDeepLodash(options.variables, \"__typename\");\r\n      const res = await (this.$vfapollo as any).mutate({\r\n        ...options,\r\n        variables,\r\n      });\r\n      if (!res.errors) {\r\n        commit(\"vuefront/setError\", false, { root: true });\r\n        commit(\"setData\", res);\r\n      } else {\r\n        commit(\"vuefront/setError\", res.errors, {\r\n          root: true,\r\n        });\r\n      }\r\n      this.$vfapollo.clearStore();\r\n    } catch (e) {\r\n      commit(\"vuefront/setResponseError\", e, {\r\n        root: true,\r\n      });\r\n    }\r\n  },\r\n  async upload(\r\n    { commit },\r\n    options: { variables: { [key: string]: any }; mutation: any }\r\n  ) {\r\n    try {\r\n      const variables: { [key: string]: any } = omitDeepLodash(\r\n        options.variables,\r\n        \"__typename\"\r\n      );\r\n\r\n      const o = {\r\n        query: options.mutation.loc.source.body,\r\n        variables,\r\n      };\r\n\r\n      const map: { [key: number]: string } = {\r\n        0: \"file\",\r\n      };\r\n\r\n      let i: number = 0;\r\n      const fd = new FormData();\r\n      fd.append(\"operations\", JSON.stringify(o));\r\n      for (const key in variables) {\r\n        if (\r\n          typeof variables[key] === \"object\" &&\r\n          variables[key] instanceof File\r\n        ) {\r\n          map[i] = key;\r\n          fd.append(i.toString(), variables[key]);\r\n          i++;\r\n        }\r\n      }\r\n\r\n      fd.append(\"map\", JSON.stringify(map));\r\n      const axios = adapterAxios.create({\r\n        withCredentials: true,\r\n      });\r\n      const { data } = await axios.post(this.$vuefront.baseURL, fd);\r\n\r\n      if (!data.errors) {\r\n        commit(\"vuefront/setError\", false, { root: true });\r\n        commit(\"setData\", data);\r\n      } else {\r\n        commit(\"vuefront/setError\", data.errors, {\r\n          root: true,\r\n        });\r\n      }\r\n    } catch (e) {\r\n      commit(\"vuefront/setResponseError\", e, {\r\n        root: true,\r\n      });\r\n    }\r\n  },\r\n};\r\n"],"file":"apollo.mjs"}