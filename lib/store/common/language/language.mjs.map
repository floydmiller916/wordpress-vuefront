{"version":3,"sources":["../../../../src/store/common/language/language.ts"],"names":["find","gql","state","language","locale","getters","get","mutations","setLanguage","setLocal","actions","load","commit","data","$vfapollo","query","active","code","e","root","edit","dispatch","rootGetters","mutation","variables","editLanguage"],"mappings":"AAGA,SAASA,IAAT,QAAqB,QAArB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AAOA,OAAO,MAAMC,KAAK,GAAG;AACnBC,EAAAA,QAAQ,EAAE,EADS;AAEnBC,EAAAA,MAAM,EAAE;AAFW,CAAd;AAKP,OAAO,MAAMC,OAAqC,GAAG;AACnDC,EAAAA,GAAG,CAACJ,KAAD,EAAQ;AACT,WAAOA,KAAK,CAACC,QAAb;AACD,GAHkD;;AAInDC,EAAAA,MAAM,CAACF,KAAD,EAAQ;AACZ,WAAOA,KAAK,CAACE,MAAb;AACD;;AANkD,CAA9C;AASP,OAAO,MAAMG,SAA8B,GAAG;AAC5CC,EAAAA,WAAW,CAACN,KAAD,EAAQC,QAAR,EAAkB;AAC3BD,IAAAA,KAAK,CAACC,QAAN,GAAiBA,QAAjB;AACD,GAH2C;;AAI5CM,EAAAA,QAAQ,CAACP,KAAD,EAAQE,MAAR,EAAgB;AACtBF,IAAAA,KAAK,CAACE,MAAN,GAAeA,MAAf;AACD;;AAN2C,CAAvC;AASP,OAAO,MAAMM,OAAqC,GAAG;AACnD,QAAMC,IAAN,OAAuB;AAAA,QAAZ;AAAEC,MAAAA;AAAF,KAAY;;AACrB,QAAI;AACF,YAAM;AAAEC,QAAAA;AAAF,UAAW,MAAM,KAAKC,SAAL,CAAeC,KAAf,CAAqB;AAC1CA,QAAAA,KAAK,EAAEd,GAAI;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVkD,OAArB,CAAvB;AAaAW,MAAAA,MAAM,CAAC,aAAD,EAAgBC,IAAI,CAACV,QAArB,CAAN;AACA,YAAMa,MAAM,GAAGhB,IAAI,CAACa,IAAI,CAACV,QAAN,EAAgB;AACjCa,QAAAA,MAAM,EAAE;AADyB,OAAhB,CAAnB;;AAIA,UAAIA,MAAJ,EAAY;AACVJ,QAAAA,MAAM,CAAC,UAAD,EAAaI,MAAM,CAACC,IAApB,CAAN;AACD;AACF,KAtBD,CAsBE,OAAOC,CAAP,EAAU;AACVN,MAAAA,MAAM,CAAC,2BAAD,EAA8BM,CAA9B,EAAiC;AACrCC,QAAAA,IAAI,EAAE;AAD+B,OAAjC,CAAN;AAGD;AACF,GA7BkD;;AA8BnD,QAAMC,IAAN,eAAwD;AAAA,QAA7C;AAAER,MAAAA,MAAF;AAAUS,MAAAA,QAAV;AAAoBC,MAAAA;AAApB,KAA6C;AAAA,QAAV;AAAEL,MAAAA;AAAF,KAAU;AACtD,UAAMI,QAAQ,CACZ,eADY,EAEZ;AACEE,MAAAA,QAAQ,EAAEtB,GAAI;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAVM;AAWEuB,MAAAA,SAAS,EAAE;AACTP,QAAAA;AADS;AAXb,KAFY,EAiBZ;AACEE,MAAAA,IAAI,EAAE;AADR,KAjBY,CAAd;;AAsBA,QAAI,CAACG,WAAW,CAAC,gBAAD,CAAhB,EAAoC;AAClCV,MAAAA,MAAM,CAAC,aAAD,EAAgBU,WAAW,CAAC,YAAD,CAAX,CAA0BG,YAA1C,CAAN;AACD;AACF;;AAxDkD,CAA9C","sourcesContent":["import { MutationTree, GetterTree, ActionTree } from \"vuex\";\nimport { RootState } from \"vuefront-store\";\nimport { Language } from \"vuefront-api\";\nimport { find } from \"lodash\";\nimport gql from \"graphql-tag\";\n\nexport type State = {\n  language: Language[];\n  locale: string;\n};\n\nexport const state = {\n  language: [],\n  locale: \"en-gb\",\n};\n\nexport const getters: GetterTree<State, RootState> = {\n  get(state) {\n    return state.language;\n  },\n  locale(state) {\n    return state.locale;\n  },\n};\n\nexport const mutations: MutationTree<State> = {\n  setLanguage(state, language) {\n    state.language = language;\n  },\n  setLocal(state, locale) {\n    state.locale = locale;\n  },\n};\n\nexport const actions: ActionTree<State, RootState> = {\n  async load({ commit }) {\n    try {\n      const { data } = await this.$vfapollo.query({\n        query: gql`\n          {\n            language {\n              name\n              image\n              code\n              active\n            }\n          }\n        `,\n      });\n\n      commit(\"setLanguage\", data.language);\n      const active = find(data.language, {\n        active: true,\n      });\n\n      if (active) {\n        commit(\"setLocal\", active.code);\n      }\n    } catch (e) {\n      commit(\"vuefront/setResponseError\", e, {\n        root: true,\n      });\n    }\n  },\n  async edit({ commit, dispatch, rootGetters }, { code }) {\n    await dispatch(\n      \"apollo/mutate\",\n      {\n        mutation: gql`\n          mutation ($code: String) {\n            editLanguage(code: $code) {\n              name\n              image\n              code\n              active\n            }\n          }\n        `,\n        variables: {\n          code,\n        },\n      },\n      {\n        root: true,\n      }\n    );\n\n    if (!rootGetters[\"vuefront/error\"]) {\n      commit(\"setLanguage\", rootGetters[\"apollo/get\"].editLanguage);\n    }\n  },\n};\n"],"file":"language.mjs"}